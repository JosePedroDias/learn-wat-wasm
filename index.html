<html>
    <head>
        <meta charset="utf-8">
        <link rel="icon" href="data:;base64,iVBORw0KGgo=">
    </head>
    <body>
        <script type="module">
            // get args via query string
            const args = location.search ? location.search.substring(1).split(',') : [];



            /* const watProm = fetch("AddInt.wasm");
            const obj = await WebAssembly.instantiateStreaming(watProm);

            const [a, b] = args.map(s => parseInt(s, 10));
            console.log('args:', [a, b]);
            const { AddInt } =  obj.instance.exports;
            if (isNaN(a) || isNaN(b)) {
                throw new Error('needs 2 integer numbers passed in as query string arguments!');
            }
            const c = AddInt(a, b);
            console.log('result:', c); */

            

            /* const memory = new WebAssembly.Memory ({ initial: 1 });

            const importObject = {
                env: {
                    buffer: memory,
                    startStringIndex: 100,
                    PrintString: (startStrIdx, strLen) => {
                        const bytes = new Uint8Array(memory.buffer, startStrIdx, strLen);
                        const strToLog = new TextDecoder('utf8').decode(bytes);
                        console.log(strToLog);
                    }
                }
            };

            const watProm = fetch("HelloWorld.wasm");
            const obj = await WebAssembly.instantiateStreaming(watProm, importObject);

            const { HelloWorld } = obj.instance.exports;
            HelloWorld(); */



            const importObject = {
                env: {
                    PrintI32: (numI32) => {
                        console.log(numI32);
                    }
                }
            };

            const watProm = fetch("ForLoop.wasm");
            const obj = await WebAssembly.instantiateStreaming(watProm, importObject);

            const { ForLoop } =  obj.instance.exports;
            const [startNum, endNum] = args.map(s => parseInt(s, 10));
            if (isNaN(startNum) || isNaN(endNum)) {
                throw new Error('needs 2 integer numbers passed in as query string arguments!');
            }
            ForLoop(startNum, endNum);
        </script>
    </body>
</html>
